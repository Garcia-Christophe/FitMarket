# Image gradle avec le jdk17
image: gradle:7.3.3-jdk17-alpine

# Etapes du pipeline
stages:
  - âš™ï¸ Build
  - ğŸ§ª Test
  - ğŸš€ Deploy

# Build
build-job:
  stage: âš™ï¸ Build
  allow_failure: false
  script:
    - echo "Compilation du code..."
    - echo "Compilation terminÃ©e."

# Test : Web
test-web:
  stage: ğŸ§ª Test
  allow_failure: false
  script:
    - echo "Tests de la partie Web..."
    - |
      if grep -q "port: 3000" ./fitmarket/vite.config.mjs; then
        echo "Le port de l'application web est bien 3000."
      else
        echo "Le port de l'application web n'est pas 3000 !"
        exit 1
      fi

# Test : Android
test-android:
  stage: ğŸ§ª Test
  allow_failure: false
  script:
    - echo "Tests de la partie Android..."
    - echo "Tests Android OK."

# Test : Spring
test-spring:
  stage: ğŸ§ª Test
  allow_failure: false
  script:
    - echo "Tests de la partie Spring..."
    - cd back/fitmarket
    - ./gradlew check
    - cd ../..

# Test : BDD
test-spring:
  stage: ğŸ§ª Test
  allow_failure: false
  script:
    - echo "Tests de la partie BDD..."
    - echo "Tables de la BDD OK."

# Deploy
deploy-job:
  stage: ğŸš€ Deploy
  allow_failure: false
  environment: production
  script:
    - echo "DÃ©ploiement de l'application..."
    - echo "Application dÃ©ployÃ©e avec succÃ¨s."
